---
layout: post
title: "The TodoMVC Showdown: Testing with WebCheck"
author: Oskar Wickström
date: 2020-07-02
categories: programming
tags: ["testing", "specification", "formal-methods", "browser"]
excerpt: |
  WebCheck is a browser testing framework
  combining ideas from property-based testing, TLA+ and linear temporal
  logic, and functional programming. In this post I'll share my results
  of testing TodoMVC implementations using WebCheck.
---

In this post I'll share the results from testing
[TodoMVC](http://todomvc.com/) implementations using my new testing tool
named _WebCheck_. I'll explain how the specification works, what problems
were found in the TodoMVC implementations, and what this means for my
project.

## WebCheck

During the last three months I've used my spare time to build
[WebCheck](https://webcheck.tools). It's a browser testing framework
combining ideas from:

- property-based testing (PBT)
- TLA+ and linear temporal logic
- functional programming

In WebCheck, you write a _specification_ for your web application, instead of
manually writing test cases. The specification describes the intended
behavior as a finite-state machine and invariants, using logic formulae
written in a language inspired by the [temporal logic of
actions](https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=&ved=2ahUKEwj344KGga7qAhXlsosKHSXnAQUQFjAEegQIARAB&url=https%3A%2F%2Flamport.azurewebsites.net%2Fpubs%2Flamport-actions.pdf&usg=AOvVaw2BwOrtWoq4Z2Y129hhj3WV)
(PDF) from TLA+. WebCheck generates hundreds or thousands of tests and runs
them to verify if your application is accepted by the specification.

The tests generated by WebCheck are sequences of possible actions, determined
from the current state of the DOM at the time of each action. You can think
of WebCheck as exploring the state space automatically, based on DOM
introspection. It can find user behaviors and problems that we, the biased
and lazy humans, are unlikely to think of and to write tests for. Our job
is instead to think about the requirements and to improve the specification
over time.

### Specifications vs Models

In property-based testing, when testing state machines using models, the
model should capture the essential complexity of the system under test (SUT).
It needs to be functionally complete to be a useful oracle. For a system that
is conceptually simple, e.g. a key-value database engine, this is not a
problem. But for a system that is inherently complex, e.g. a business
application with a big pile of rules, a useful model tends to grow _as
complex_ as the system itself.

In WebCheck, the specification is not like such a model. You don't have to
implement a complete functional model of your system. You can leave out
details and specify only the most important aspects of your application. As
an example, I wrote a specification that states that "there should at no time
be more than one spinner on a page", and nothing else. Again, this is
possible to specify in PBT in general, but not with _model-based_ PBT, from
what I've seen.

### TodoMVC as a Benchmark

Since the start of this project, I've used the TodoMVC implementations as a
benchmark of WebCheck, and developed a general specification for TodoMVC
implementations. The TodoMVC contribution documentation has [a high-level
feature
specification](https://github.com/tastejs/todomvc/blob/master/app-spec.md#functionality),
and the project has a Cypress test suite, but I was curious if I could find
anything new using WebCheck.

Early on, checking the mainstream framework implementations, I found that
both the Angular and Mithril implementations were rejected by my
specification, and I submitted [an
issue](https://github.com/tastejs/todomvc/issues/2116) in the TodoMVC issue
tracker. Invigorated by the initial success, I decided to check the remaining
implementations and gradually improve my specification.

I've generalized the specification to work on nearly all the implementations
listed on the TodoMVC website. Some of them use the old markup, which uses
IDs instead of classes for most elements, so I had to support both variants.

## The Specification

Before looking at the tests results, you might want to have a look at the
WebCheck specification that I've published as a gist:

[TodoMVC.spec.purs]( https://gist.github.com/owickstrom/1a0698ef6a47df07dfc1fe59eda12983)

The gist includes a brief introduction to the WebCheck specification language
and how to write specifications. I'll write proper documentation for the
specification language eventually, but this can give you a taste of how it
works, at least. I've excluded support for the old TodoMVC markup to keep the
specification as simple as possible.

The specification doesn't cover all features of TodoMVC yet. Most notably, it
leaves out the [editing
mode](https://github.com/tastejs/todomvc/blob/master/app-spec.md#editing)
entirely. Further, it doesn't cover the usage of local storage in TodoMVC,
and local storage is disabled in WebCheck for now.

I might refine the specification later, but I think I've found enough to
motivate using WebCheck on TodoMVC applications. Further, this is likely how
WebCheck would be used in other projects. You specify some things and you
leave out others.

The astute reader might have noticed that the specification language looks
like PureScript. And it pretty much is PureScript, with some
WebCheck-specific additions for temporal modalities and DOM queries. I
decided not to write a custom DSL, and instead write a PureScript
interpreter. That way, specification authors can use the tools and packages
from the PureScript ecosystem. It works great so far!

## Test Results

Below are the test results from running WebCheck and my TodoMVC specification
on the examples listed on the TodoMVC website. I'll use short descriptions of
the problems (some of which are recurring), and explain in more detail
further down.

<table style="width: 100%;" class="todomvc-results">
    <thead>
        <tr>
            <th style="width: 1%;"></th>
            <th>Example</th>
            <th>Problems/Notes</th>
        </tr>
    </thead>
    <tbody>
        <tr class="divider"><td colspan="3">Pure JavaScript</td></tr>
        <tr>
            <td>✓</td>
            <td>Backbone.js</td>
            <td></td>
        </tr>
        <tr>
            <td>❌</td>
            <td>AngularJS</td>
            <td><ul><li>Clears input field on filter change</li></ul></td>
        </tr>
        <tr>
            <td>✓</td>
            <td>Ember.js</td>
            <td></td>
        </tr>
        <tr>
            <td>✓</td>
            <td>Dojo</td>
            <td></td>
        </tr>
        <tr>
            <td>✓</td>
            <td>Knockback</td>
            <td></td>
        </tr>
        <tr>
            <td>✓</td>
            <td>CanJS</td>
            <td></td>
        </tr>
        <tr>
            <td>✓</td>
            <td>Polymer</td>
            <td></td>
        </tr>
        <tr>
            <td>✓</td>
            <td>React</td>
            <td></td>
        </tr>
        <tr>
            <td>❌</td>
            <td>Mithril</td>
            <td><ul><li>Clears input field on filter change</li></ul></td>
        </tr>
        <tr>
            <td>✓</td>
            <td>Vue</td>
            <td></td>
        </tr>
        <tr>
            <td>✓</td>
            <td>MarionetteJS</td>
            <td></td>
        </tr>
        <tr class="divider"><td colspan="3">Compiled to JavaScript</td></tr>
        <tr>
            <td>✓</td>
            <td>Kotlin + React</td>
            <td></td>
        </tr>
        <tr>
            <td>✓</td>
            <td>Spine</td>
            <td></td>
        </tr>
        <tr>
            <td>✓</td>
            <td>Dart</td>
            <td></td>
        </tr>
        <tr>
            <td>✓</td>
            <td>GWT</td>
            <td></td>
        </tr>
        <tr>
            <td>✓</td>
            <td>Closure</td>
            <td></td>
        </tr>
        <tr>
            <td>✓</td>
            <td>Elm</td>
            <td></td>
        </tr>
        <tr>
            <td>❌</td>
            <td>AngularDart</td>
            <td>
                <ul>
                    <li>Race condition on initialization</li>
                    <li>Filters not implemented</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>✓</td>
            <td>TypeScript + Backbone.js</td>
            <td></td>
        </tr>
        <tr>
            <td>✓</td>
            <td>TypeScript + AngularJS</td>
            <td></td>
        </tr>
        <tr>
            <td>✓</td>
            <td>TypeScript + React</td>
            <td></td>
        </tr>
        <tr>
            <td>✓</td>
            <td>Reagent</td>
            <td></td>
        </tr>
        <tr>
            <td>✓</td>
            <td>Scala.js + React</td>
            <td></td>
        </tr>
        <tr>
            <td>✓</td>
            <td>Scala.js + Binding.scala</td>
            <td></td>
        </tr>
        <tr>
            <td>✓</td>
            <td>js_of_ocaml</td>
            <td></td>
        </tr>
        <tr>
            <td>&ndash;</td>
            <td>Humble + GopherJS</td>
            <td><ul><li>Missing/broken link</li></ul></td>
        </tr>
        <tr class="divider"><td colspan="3">Under evaluation by TodoMVC</td></tr>
        <tr>
            <td>✓</td>
            <td>Backbone.js + RequireJS</td>
            <td></td>
        </tr>
        <tr>
            <td>❌</td>
            <td>KnockoutJS + RequireJS</td>
            <td>
                <ul>
                    <li>Inconsistent first render</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>✓</td>
            <td>AngularJS + RequireJS</td>
            <td>
                <ul>
                    <li>Needs a custom <code>readyWhen</code> condition</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>✓</td>
            <td>CanJS + RequireJS</td>
            <td></td>
        </tr>
        <tr>
            <td>❌</td>
            <td>Lavaca + RequireJS</td>
            <td>
                <ul>
                    <li>Clears input field on filter change</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>❌</td>
            <td>cujoJS</td>
            <td>
                <ul>
                    <li>Race condition on initialization</li>
                    <li>Filters not implemented</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>✓</td>
            <td>Sammy.js</td>
            <td></td>
        </tr>
        <tr>
            <td>&ndash;</td>
            <td>soma.js</td>
            <td>
                <ul>
                    <li>Missing/broken link</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>❌</td>
            <td>DUEL</td>
            <td>
                <ul>
                    <li>Clears input field on filter change</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>✓</td>
            <td>Kendo UI</td>
            <td></td>
        </tr>
        <tr>
            <td>❌</td>
            <td>Dijon</td>
            <td>
                <ul>
                    <li>Filters not implemented</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>✓</td>
            <td>Enyo + Backbone.js</td>
            <td></td>
        </tr>
        <tr>
            <td>❌</td>
            <td>SAPUI5</td>
            <td>
                <ul>
                    <li>No input field</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>✓</td>
            <td>Exoskeleton</td>
            <td></td>
        </tr>
        <tr>
            <td>✓</td>
            <td>Ractive.js</td>
            <td></td>
        </tr>
        <tr>
            <td>✓</td>
            <td>React + Alt</td>
            <td></td>
        </tr>
        <tr>
            <td>✓</td>
            <td>React + Backbone.js</td>
            <td></td>
        </tr>
        <tr>
            <td>✓</td>
            <td>Aurelia</td>
            <td></td>
        </tr>
        <tr>
            <td>❌</td>
            <td>Angular 2.0</td>
            <td>
                <ul>
                    <li>Filters not implemented</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>✓</td>
            <td>Riot</td>
            <td></td>
        </tr>
        <tr>
            <td>✓</td>
            <td>JSBlocks</td>
            <td></td>
        </tr>
        <tr class="divider"><td colspan="3">Real-time</td></tr>
        <tr>
            <td>&ndash;</td>
            <td>SocketStream</td>
            <td>
                <ul>
                    <li>State cannot be cleared</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>✓</td>
            <td>Firebase + AngularJS</td>
            <td></td>
        </tr>
        <tr class="divider"><td colspan="3">Node.js</td></tr>
        <tr>
            <td>&ndash;</td>
            <td>Express + gcloud-node</td>
            <td>
                <ul>
                    <li>Missing/broken link</li>
                </ul>
            </td>
        </tr>
        <tr class="divider"><td colspan="3">Non-framework implementations</td></tr>
        <tr>
            <td>❌</td>
            <td>VanillaJS</td>
            <td>
                <ul>
                    <li>Adds pending item on other interaction</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>❌</td>
            <td>VanillaJS ES6</td>
            <td>
                <ul>
                    <li>Adds pending item on other interaction</li>
                    <li><code>.todo-count strong</code> is missing</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>✓</td>
            <td>jQuery</td>
            <td></td>
        </tr>
    </tbody>
    <tfoot>
        <tr class="todomvc-legend">
            <td colspan="3">✓ Passed, ❌ Failed, &ndash; Not testable</td>
        </tr>
    </tfoot>
</table>


Filters not implemented

: There's no way of switching between "All", "Active", and "Completed" items.
This is specified in the TodoMVC documentation under
[Routing](https://github.com/tastejs/todomvc/blob/master/app-spec.md#routing).

Race condition during initialization

: The event listeners are attached some time after the `.new-todo` form is
rendered. Although unlikely, if you're quick enough you can focus the input,
press <kbd>Return</kbd>, and post the form. This will navigate the user agent
to the same page but with a query parameter, e.g. `index.html?text=`. In
TodoMVC it's not the end of the world, but there are systems where you do not
want this to happen.

Inconsistent first render

: The application briefly shows an inconsistent view, then renders the valid initial state. _KnockoutJS + RequireJS_ shows an empty list items and "0 left" in the bottom, even though the footer [should be hidden when there are no items](https://github.com/tastejs/todomvc/blob/master/app-spec.md#no-todos).

Needs a custom `readyWhen` condition

: The specification awaits an element matching `.todoapp` (or `#todoapp` for
the old markup) in the DOM before taking any action. In this case, the
implementation needs a modified specification that instead awaits a
framework-specific class, e.g. `.ng-scope`. This is an inconvenience in
testing the implementation using WebCheck, rather than an error.

No input field

: There's no input field to enter TODO items in. I'd argue this defeats the
purpose of a TODO list application, and it's [indeed specified in the official
documentation](https://github.com/tastejs/todomvc/blob/master/app-spec.md#new-todo).

Adds pending item on other interaction

: When there's a pending item in the input field, and another action is taken
(toggle all, change filter, etc), the pending item is submitted
automatically without a <kbd>Return</kbd> key press.

`.todo-count strong` element is missing

: An element matching the selector `.todo-count strong` must be present in
the DOM when there are items, showing the number of active items, as
described [in the TodoMVC
documentation](https://github.com/tastejs/todomvc/blob/master/app-spec.md#counter).

State cannot be cleared

: This is not an implementation error, but an issue where the test
implementation makes it hard to perform repeated isolated testing. State
cannot (to my knowledge) be cleared between tests, and so isolation is
broken. This points to a key requirement currently placed by WebCheck: the
SUT must be stateless, with respect to a new private browser window. In
future versions of WebCheck, I'll add hooks to let the tester clear
the system state before each test is run.

Missing/broken link

: The listed implementation seems to be moved or decommissioned.

Note that I can't decide which of these problems are _bugs_. That's up to the
TodoMVC project maintainers. I see them as problems, or disagreements,
between the implementations and my specification. A good chunk of humility is
in order when testing systems designed and built by others.

## The Future is Bright

I'm happy with how effective WebCheck has been so far, after only a few
months of spare-time prototyping. Hopefully, I'll have something more
polished that I can make available soon. An open source tool that you can run
yourself, a SaaS version with a subscription model, or maybe both. When that
time comes, maybe WebCheck can be part of the TodoMVC project's testing. And
perhaps in your project?

If you're interested in WebCheck, please [sign up for the
newsletter](https://buttondown.email/webcheck). I'll post regular project
updates, and definitely no spam. You can also follow me [on
Twitter](https://twitter.com/owickstrom).


## Comments

If you have any comments or questions, please reply to any of the following
threads:

- [Twitter](https://twitter.com/owickstrom/status/1278645144166825984)
- [Lobste.rs](https://lobste.rs/s/pqo6ou/todomvc_showdown_testing_with_webcheck)

_Thanks to [Hillel Wayne](https://www.hillelwayne.com/), [Felix
Holmgren](https://twitter.com/felixhgren), [Martin
Janiczek](https://twitter.com/janiczek), [Tom Harding](https://twitter.com/am_i_tom), and [Martin
Clausen](https://twitter.com/MartinClausen8) for reviewing drafts of this
post._